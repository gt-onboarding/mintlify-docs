---
title: "身份验证设置"
description: "通过用户身份验证来控制文档的隐私"
keywords: ['auth']
---

<Info>
  [Pro 方案](https://mintlify.com/pricing?ref=authentication) 包含密码认证。

  [Enterprise 方案](https://mintlify.com/pricing?ref=authentication) 支持所有身份验证方式。
</Info>

启用身份验证后，用户需要先登录才能访问你的文档。

<div id="authentication-modes">
  ## 身份验证模式
</div>

请根据访问控制需求在完整或部分身份验证模式之间进行选择。

**完整身份验证**：所有页面均受保护。用户必须先登录才能访问任何内容。

**部分身份验证**：部分页面对公众开放，其他页面需通过身份验证。用户可自由浏览公开内容，仅在访问受保护页面时进行身份验证。

在配置下方任一握手机制时，你需要在控制台设置中选择 **完整身份验证** 或 **部分身份验证**。

<div id="configuring-authentication">
  ## 配置身份验证
</div>

选择要配置的握手机制。

<Tabs>
  <Tab title="密码">
    <Info>
      密码身份验证仅用于访问控制，**不**支持内容个性化。
    </Info>

    ### 先决条件

    * 你的安全策略允许在用户之间共享同一密码。

    ### 实施

    <Steps>
      <Step title="创建密码">
        1. 在控制台中前往 [Authentication](https://dashboard.mintlify.com/settings/deployment/authentication)。
        2. 选择 **Full Authentication** 或 **Partial Authentication**。
        3. 选择 **Password**。
        4. 输入一个强密码。
        5. 选择 **Save changes**。
      </Step>

      <Step title="分发访问权限">
        将密码和文档 URL 安全地分享给获授权的用户。
      </Step>
    </Steps>

    ## 示例

    你的文档托管在 `docs.foo.com`，你需要基本的访问控制，但不跟踪单个用户。你希望阻止公众访问，同时保持设置简单。

    在控制台中**创建强密码**，并将**凭据**分享给获授权的用户。就是这么简单！
  </Tab>

  <Tab title="Mintlify 控制台">
    ### 先决条件

    * 你的文档使用者同时也是文档编辑者。

    ### 实施

    <Steps>
      <Step title="启用 Mintlify 控制台身份验证。">
        1. 在控制台中，前往 [Authentication](https://dashboard.mintlify.com/settings/deployment/authentication)。
        2. 选择 **Full Authentication** 或 **Partial Authentication（部分身份验证）**。
        3. 选择 **Mintlify Auth**。
        4. 选择 **Enable Mintlify Auth**。
      </Step>

      <Step title="添加授权用户。">
        1. 在控制台中，前往 [Members](https://dashboard.mintlify.com/settings/organization/members)。
        2. 将需要访问你文档的每位成员添加到组织。
        3. 根据其编辑权限分配合适的角色。
      </Step>
    </Steps>

    ### 示例

    你的文档托管在 `docs.foo.com`，你的团队使用控制台来编辑文档。你希望仅限团队成员访问。

    在控制台设置中**启用 Mintlify 身份验证**。

    通过检查所有团队成员是否已添加到你的组织来**验证团队访问权限**。
  </Tab>

  <Tab title="OAuth 2.0">
    ### 前提条件

    * 支持授权码流程（Authorization Code Flow）的 OAuth 或 OIDC 服务器。
    * 能创建可由 OAuth 访问令牌访问的 API 端点（可选，用于启用个性化功能）。

    ### 实施

    <Steps>
      <Step title="配置 OAuth 设置。">
        1. 在仪表盘中前往 [Authentication](https://dashboard.mintlify.com/settings/deployment/authentication)。
        2. 选择 **Full Authentication** 或 **Partial Authentication**（完整身份验证或部分身份验证）。
        3. 选择 **OAuth** 并配置以下字段：

        * **Authorization URL**：OAuth 授权端点。
        * **Client ID**：OAuth 2.0 客户端标识符。
        * **Client Secret**：OAuth 2.0 客户端密钥。
        * **Scopes**：请求的权限。复制 scope 字符串的**全部内容**（例如，对于 `provider.users.docs` 这样的 scope，请完整复制 `provider.users.docs`）。如需不同的访问级别，可使用多个 scope。
        * **Token URL**：OAuth 令牌交换端点。
        * **Info API URL**（可选）：用于检索用户信息以实现个性化的端点。如留空，OAuth 流程仅用于验证身份，用户信息将为空。
        * **Logout URL**：OAuth 提供商的原生登出 URL。若提供商提供 `returnTo` 或类似参数，请将其指回你的文档 URL。

        4. 选择 **Save changes**。
      </Step>

      <Step title="配置 OAuth 服务器。">
        1. 从[身份验证设置](https://dashboard.mintlify.com/settings/deployment/authentication)中复制 **Redirect URL**。
        2. 将该重定向 URL 添加为 OAuth 服务器的已授权重定向 URL。
      </Step>

      <Step title="创建用户信息端点（可选）。">
        为启用个性化功能，创建一个 API 端点，该端点：

        * 接受 OAuth 访问令牌进行身份验证。
        * 按 `User` 格式返回用户数据。详见 [User data format](/zh/deploy/personalization-setup#user-data-format)。

        将该端点 URL 填入[身份验证设置](https://dashboard.mintlify.com/settings/deployment/authentication)中的 **Info API URL** 字段。
      </Step>
    </Steps>

    ### 示例

    你的文档托管在 `foo.com/docs`，且在 `auth.foo.com` 上已有支持授权码流程的 OAuth 服务器。

    在仪表盘中**配置 OAuth 服务器详细信息**：

    * **Authorization URL**：`https://auth.foo.com/authorization`
    * **Client ID**：`ydybo4SD8PR73vzWWd6S0ObH`
    * **Scopes**：`['provider.users.docs']`
    * **Token URL**：`https://auth.foo.com/exchange`
    * **Info API URL**：`https://api.foo.com/docs/user-info`
    * **Logout URL**：`https://auth.foo.com/logout?returnTo=https%3A%2F%2Ffoo.com%2Fdocs`

    **创建用户信息端点** `api.foo.com/docs/user-info`，该端点要求携带具有 `provider.users.docs` scope 的 OAuth 访问令牌，并返回：

    ```json
    {
      "content": {
        "firstName": "Jane",
        "lastName": "Doe"
      },
      "groups": ["engineering", "admin"]
    }
    ```

    **将你的 OAuth 服务器配置为允许重定向**到回调 URL。
  </Tab>

  <Tab title="JWT">
    ### 先决条件

    * 一个能够生成并签署 JWT 的身份验证系统。
    * 一个能够创建重定向 URL 的后端服务。

    ### 实施

    <Steps>
      <Step title="生成私钥。">
        1. 在你的控制台中，前往 [Authentication](https://dashboard.mintlify.com/settings/deployment/authentication)。
        2. 选择 **Full Authentication** 或 **Partial Authentication**。
        3. 选择 **JWT**。
        4. 输入你现有登录流程的 URL，并选择 **Save changes**。
        5. 选择 **Generate new key**。
        6. 将密钥安全存储在后端可访问的位置。
      </Step>

      <Step title="将 Mintlify 身份验证集成到你的登录流程中。">
        在用户完成身份验证后，修改你现有的登录流程以包含以下步骤：

        * 按 `User` 格式创建一个包含已认证用户信息的 JWT。更多信息参见 [User data format](/zh/deploy/personalization-setup#user-data-format)。
        * 使用 EdDSA 算法，使用你的私钥对 JWT 进行签名。
        * 创建一个重定向 URL，返回到文档的 `/login/jwt-callback` 路径，并将 JWT 作为 URL 片段（hash）附加其后。
      </Step>
    </Steps>

    ### 示例

    你的文档托管在 `docs.foo.com`，现有的身份验证系统位于 `foo.com`。你希望扩展登录流程，在保持文档与控制台分离的同时为文档授予访问权限（或者你没有控制台）。

    在 `https://foo.com/docs-login` 创建一个登录端点，以扩展你现有的身份验证。

    在验证用户凭据之后：

    * 生成一个包含用户数据、符合 Mintlify 格式的 JWT。
    * 对 JWT 进行签名并重定向到 `https://docs.foo.com/login/jwt-callback#{SIGNED_JWT}`。

    <CodeGroup>
      ```ts TypeScript
      import * as jose from 'jose';
      import { Request, Response } from 'express';

      const TWO_WEEKS_IN_MS = 1000 * 60 * 60 * 24 * 7 * 2;

      const signingKey = await jose.importPKCS8(process.env.MINTLIFY_PRIVATE_KEY, 'EdDSA');

      export async function handleRequest(req: Request, res: Response) {
        const user = {
          expiresAt: Math.floor((Date.now() + TWO_WEEKS_IN_MS) / 1000), // 2 week session expiration
          groups: res.locals.user.groups,
          content: {
            firstName: res.locals.user.firstName,
            lastName: res.locals.user.lastName,
          },
        };

        const jwt = await new jose.SignJWT(user)
          .setProtectedHeader({ alg: 'EdDSA' })
          .setExpirationTime('10 s') // 10 second JWT expiration
          .sign(signingKey);

        return res.redirect(`https://docs.foo.com/login/jwt-callback#${jwt}`);
      }
      ```

      ```python Python
      import jwt # pyjwt
      import os

      from datetime import datetime, timedelta
      from fastapi.responses import RedirectResponse

      private_key = os.getenv(MINTLIFY_JWT_PEM_SECRET_NAME, '')

      @router.get('/auth')
      async def return_mintlify_auth_status(current_user):
        jwt_token = jwt.encode(
          payload={
            'exp': int((datetime.now() + timedelta(seconds=10)).timestamp()),    # 10 second JWT expiration
            'expiresAt': int((datetime.now() + timedelta(weeks=2)).timestamp()), # 1 week session expiration
            'groups': ['admin'] if current_user.is_admin else [],
            'content': {
              'firstName': current_user.first_name,
              'lastName': current_user.last_name,
            },
          },
          key=private_key,
          algorithm='EdDSA'
        )

        return RedirectResponse(url=f'https://docs.foo.com/login/jwt-callback#{jwt_token}', status_code=302)
      ```
    </CodeGroup>

    ### 重定向未认证用户

    当未认证用户尝试访问受保护页面时，他们的目标地址会在重定向到你的登录 URL 时被保留：

    1. 用户尝试访问受保护页面：`https://docs.foo.com/quickstart`。
    2. 重定向到你的登录 URL，并携带 redirect 查询参数：`https://foo.com/docs-login?redirect=%2Fquickstart`。
    3. 完成身份验证后，重定向到 `https://docs.foo.com/login/jwt-callback?redirect=%2Fquickstart#{SIGNED_JWT}`。
    4. 用户到达其最初的目标页面。
  </Tab>
</Tabs>

<div id="making-pages-public">
  ## 将页面设为公开
</div>

使用部分身份验证时，默认所有页面均受保护。你可以在页面或分组级别通过 `public` 属性将特定页面设置为无需身份验证即可访问。

<div id="page-level">
  ### 页面级
</div>

要将页面设为公开，请在该页面的 frontmatter 中添加 `public: true`。

```mdx Public page example
---
title: "公开页面"
public: true
---
```

<div id="group-level">
  ### 组级别
</div>

要将某个分组中的所有页面设为公开，请在 `docs.json` 的 `navigation` 对象中该分组名称下添加 `"public": true`。

```json Public group example
{
  "navigation": {
    "groups": [
      {
        "group": "公开分组",
        "public": true,
        "icon": "play",
        "pages": [
          "quickstart",
          "installation",
          "settings"
        ]
      },
      {
        "group": "私密分组",
        "icon": "pause",
        "pages": [
          "private-information",
          "secret-settings"
        ]
      }
    ]
  }
}
```
